echo "🚀 Validation avant push..."

# Vérifier la construction du projet
echo "📦 Vérification du build..."
if ! pnpm run build; then
  echo "❌ Build échoué. Push annulé."
  exit 1
fi

# Vérifier l'historique des commits (optionnel - ne bloque pas le push si ça échoue)
echo "📝 Validation de l'historique des commits..."
if ! pnpx commitlint --from=origin/main --to=HEAD 2>/dev/null; then
  echo "⚠️  Avertissement: Validation des commits échouée, mais le push continue..."
fi

# Tests optionnels (ne bloquent pas le push mais informent)
echo "🧪 Vérification des tests..."
if ! timeout 30s pnpm run test --run 2>/dev/null; then
  echo "⚠️  Avertissement: Certains tests échouent, mais le push continue..."
fi

echo "✅ Prêt pour le push!"
